<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Subscription - Premium API</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back
            </a>
            <h1><i class="fas fa-crown"></i> Premium Subscription</h1>
        </div>
        
        <div class="subscription-container">
            <div class="pricing-card">
                <div class="price-header">
                    <i class="fas fa-crown"></i>
                    <h2>Premium Plan</h2>
                    <div class="price">‚Çπ299<span>/month</span></div>
                </div>
                
                <ul class="features-list">
                    <li><i class="fas fa-check"></i> Unlimited API Calls</li>
                    <li><i class="fas fa-check"></i> Priority Support</li>
                    <li><i class="fas fa-check"></i> Advanced Analytics</li>
                    <li><i class="fas fa-check"></i> No Rate Limiting</li>
                </ul>
                
                <div class="subscription-form">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="userName" placeholder="Full Name" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="userEmail" placeholder="Email Address" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="userPhone" placeholder="Phone Number" required>
                    </div>
                    
                    <button type="button" id="rzp-button1" class="btn btn-premium btn-submit">
                        <span class="btn-text">
                            <i class="fas fa-credit-card"></i> Pay ‚Çπ299
                        </span>
                        <div class="loading-spinner"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Razorpay Checkout Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <!-- Direct Payment Script -->
    <script>
        // Direct Frontend Razorpay Integration
        console.log('üöÄ Frontend Razorpay Integration Loaded');
        
        document.addEventListener('DOMContentLoaded', function() {
            const payButton = document.getElementById('rzp-button1');
            
            if (!payButton) {
                console.error('‚ùå Payment button not found');
                return;
            }
            
            console.log('‚úÖ Payment button found, adding click handler');
            
            payButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                console.log('üí≥ Payment button clicked');
                
                // Get form data
                const name = document.getElementById('userName').value.trim();
                const email = document.getElementById('userEmail').value.trim();
                const phone = document.getElementById('userPhone').value.trim();
                
                console.log('üìù Form data:', {name, email, phone});
                
                // Validation
                if (!name || !email || !phone) {
                    alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä fields ‡§≠‡§∞‡•á‡§Ç');
                    return;
                }
                
                if (!email.includes('@') || !email.includes('.')) {
                    alert('‡§ï‡•É‡§™‡§Ø‡§æ valid email address enter ‡§ï‡§∞‡•á‡§Ç');
                    return;
                }
                
                if (phone.length < 10) {
                    alert('‡§ï‡•É‡§™‡§Ø‡§æ valid phone number enter ‡§ï‡§∞‡•á‡§Ç');
                    return;
                }
                
                // Show loading
                payButton.classList.add('loading');
                payButton.disabled = true;
                
                // Check if Razorpay loaded
                if (typeof Razorpay === 'undefined') {
                    alert('Razorpay SDK not loaded. Please refresh the page.');
                    payButton.classList.remove('loading');
                    payButton.disabled = false;
                    return;
                }
                
                console.log('üéØ Opening Razorpay payment...');
                
                // Direct Razorpay Options
                const options = {
                    "key": "rzp_test_lkoFfNbWaRVyLf", // Your Razorpay Key ID
                    "amount": 29900, // Amount in paise (‚Çπ299)
                    "currency": "INR",
                    "name": "Premium API Service",
                    "description": "Premium Subscription - ‚Çπ299/month",
                    "image": "https://your-logo-url.com/logo.png", // Optional logo
                    "handler": function (response) {
                        console.log('‚úÖ Payment successful:', response);
                        handlePaymentSuccess(response, {name, email, phone});
                    },
                    "prefill": {
                        "name": name,
                        "email": email,
                        "contact": phone
                    },
                    "notes": {
                        "plan": "Premium",
                        "user_name": name,
                        "user_email": email
                    },
                    "theme": {
                        "color": "#667eea"
                    },
                    "modal": {
                        "ondismiss": function() {
                            console.log('‚ùå Payment popup closed');
                            payButton.classList.remove('loading');
                            payButton.disabled = false;
                        }
                    }
                };
                
                // Create Razorpay instance
                const rzp1 = new Razorpay(options);
                
                // Handle payment failure
                rzp1.on('payment.failed', function (response) {
                    console.error('‚ùå Payment failed:', response);
                    payButton.classList.remove('loading');
                    payButton.disabled = false;
                    alert('Payment failed: ' + response.error.description);
                });
                
                // Open payment popup
                rzp1.open();
            });
        });
        
        // Handle Payment Success
        function handlePaymentSuccess(paymentResponse, userData) {
            console.log('üéâ Processing payment success...');
            
            // Store user data in localStorage
            const premiumUserData = {
                name: userData.name,
                email: userData.email,
                phone: userData.phone,
                payment_id: paymentResponse.razorpay_payment_id,
                plan: 'premium',
                status: 'active',
                subscription_date: Date.now(),
                amount: 299
            };
            
            localStorage.setItem('premium_user', JSON.stringify(premiumUserData));
            console.log('üíæ User data saved to localStorage');
            
            // Show success message
            alert('üéâ Payment Successful!\n\nPayment ID: ' + paymentResponse.razorpay_payment_id + '\n\n‡§Ü‡§™‡§ï‡§æ Premium Subscription activate ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à!');
            
            // Optional: Send data to your backend for verification
            sendPaymentDataToBackend(paymentResponse, userData);
            
            // Redirect to dashboard after delay
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 3000);
        }
        
        // Optional: Send payment data to backend (if needed)
        async function sendPaymentDataToBackend(paymentResponse, userData) {
            try {
                console.log('üì° Sending payment data to backend...');
                
                const response = await fetch('/api/payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'verify_payment',
                        payment_id: paymentResponse.razorpay_payment_id,
                        user_data: userData,
                        amount: 29900
                    })
                });
                
                if (response.ok) {
                    console.log('‚úÖ Payment data sent to backend successfully');
                } else {
                    console.log('‚ö†Ô∏è Backend verification failed (but payment was successful)');
                }
                
            } catch (error) {
                console.log('‚ö†Ô∏è Backend communication failed (but payment was successful):', error);
            }
        }
    </script>
</body>
</html>
